<!DOCTYPE html>
<html lang="en">
<head>
<title>CrossTracks</title>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<style type="text/css">
.myTable { width:400px;background-color:#eee;border-collapse:collapse; }
.myTable th { background-color:#000;color:white;width:50%; }
.myTable td, .myTable th { padding:5px;border:1px solid #000; }
</style>
</head>
<body>
  
<h1>Please note, this page is incomplete.</h1>
<h2>Not for general use</h2>
<h3>To start, please fill this in:</h3>

  From: <input type="text" id="start" name="start">
  To: <input type="text" id="end" name="end">
  Token: <input type="text" id="token" name="token">
  <button onclick="javascript:fetch()">Populate Table</button>

  <br><br>
<table class="myTable">
<tr>
<th>
FROM
</th>
<th>
TO
</th>
<th>
ARRIVING
</th>
<th>
COMPANY
</th>
<th>
ON TIME
</th>
<tr>
<td id="1aID"></td>
<td id="1bID"></td>
<td id="1cID"></td>
<td id="1dID"></td>
<td id="1eID"></td>
<td id="info1ID"></td>
</tr>
<tr>
<td id="2aID"></td>
<td id="2bID"></td>
<td id="2cID"></td>
<td id="2dID"></td>
<td id="2eID"></td>
<td id="info2ID"></td>
</tr>
</table>
<div id="msgID" ></div>
<br><hr><br>
  <p id="id01"></p><br><br>
<script>
function fetch() {
var r = new XMLHttpRequest();
var token = document.getElementById("token").value;
var start = document.getElementById("start").value;
var end = document.getElementById("end").value;  
var url1 = "https://crosstracks2.apphb.com/departures/";
var url2 = "/to/";
var url3 = "?accessToken=";
var url4 = "&expand=true";
var points = [url1, start, url2, end, url3, token, url4];
var url0 = points.join('');
r.open("GET", url0, true);
r.onreadystatechange = function () {
    if (r.readyState != 4 || r.status != 200) return;
    var resp = JSON.parse(r.response);
    if (resp.trainServices && resp.trainServices.length > 0) {
      document.getElementById("id01").innerHTML = "The next train to arrive at " + resp.locationName + " for " + resp.trainServices[0].destination[0].locationName + " will get in at " + resp.trainServices[0].previousCallingPoints[0].callingPoint + " (" + resp.trainServices[0].etd + ").";
document.getElementById("1aID").innerHTML = resp.locationName;
document.getElementById("1bID").innerHTML = resp.trainServices[0].destination[0].locationName;
document.getElementById("1cID").innerHTML = resp.trainServices[0].std;
document.getElementById("1dID").innerHTML = resp.trainServices[0].operator;
document.getElementById("1eID").innerHTML = resp.trainServices[0].etd;
document.getElementById("2aID").innerHTML = resp.locationName;
document.getElementById("2bID").innerHTML = resp.trainServices[1].destination[0].locationName;
document.getElementById("2cID").innerHTML = resp.trainServices[1].std;
document.getElementById("2dID").innerHTML = resp.trainServices[1].operator;
document.getElementById("2eID").innerHTML = resp.trainServices[1].etd;
document.getElementById("msgID").innerHTML = resp.nrccMessages;
 } else {
        alert("Sorry, no trains from " + resp.filterLocationName + " arriving soon. Check if you made a typo in the station code.");
    }
};
r.send();
};
</script>

<input type="button" onclick="CreateTableFromJSON()" value="Create Table From JSON" />
<p id="showData"></p>
<script>
  function CreateTableFromJSON() {
var r = new XMLHttpRequest();
var token = document.getElementById("token").value;
var start = document.getElementById("start").value;
var end = document.getElementById("end").value;  
var url1 = "https://crosstracks2.apphb.com/departures/";
var url2 = "/to/";
var url3 = "?accessToken=";
var url4 = "&expand=true";
var points = [url1, start, url2, end, url3, token, url4];
var url0 = points.join('');
r.open("GET", url0, true);
r.onreadystatechange = function () {
    if (r.readyState != 4 || r.status != 200) return;
    var resp = JSON.parse(r.response);
    if (resp.trainServices && resp.trainServices.length > 0) {
      document.getElementById("id01").innerHTML = "The next train to arrive at " + resp.locationName + " for " + resp.trainServices[0].destination[0].locationName + " will get in at " + resp.trainServices[0].eta + " (" + resp.trainServices[0].etd + ").";
document.getElementById("1aID").innerHTML = resp.locationName;
document.getElementById("1bID").innerHTML = resp.trainServices[0].destination[0].locationName;
document.getElementById("1cID").innerHTML = resp.trainServices[0].std;
document.getElementById("1dID").innerHTML = resp.trainServices[0].operator;
document.getElementById("1eID").innerHTML = resp.trainServices[0].etd;
document.getElementById("2aID").innerHTML = resp.locationName;
document.getElementById("2bID").innerHTML = resp.trainServices[1].destination[0].locationName;
document.getElementById("2cID").innerHTML = resp.trainServices[1].std;
document.getElementById("2dID").innerHTML = resp.trainServices[1].operator;
document.getElementById("2eID").innerHTML = resp.trainServices[1].etd;
document.getElementById("msgID").innerHTML = resp.nrccMessages;
 } else {
        alert("Sorry, no trains from " + resp.filterLocationName + " arriving soon. Check if you made a typo in the station code.");
    }
};
r.send();
};
      var myBooks = resp.trainServices[0].previousCallingPoints[0].callingPoint
      

      // EXTRACT VALUE FOR HTML HEADER. 
      // ('Book ID', 'Book Name', 'Category' and 'Price')
      var col = [];
      for (var i = 0; i < myBooks.length; i++) {
          for (var key in myBooks[i]) {
              if (col.indexOf(key) === -1) {
                  col.push(key);
              }
          }
      }

      // CREATE DYNAMIC TABLE.
      var table = document.createElement("table");

      // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

      var tr = table.insertRow(-1);                   // TABLE ROW.

      for (var i = 0; i < col.length; i++) {
          var th = document.createElement("th");      // TABLE HEADER.
          th.innerHTML = col[i];
          tr.appendChild(th);
      }

      // ADD JSON DATA TO THE TABLE AS ROWS.
      for (var i = 0; i < myBooks.length; i++) {

          tr = table.insertRow(-1);

          for (var j = 0; j < col.length; j++) {
              var tabCell = tr.insertCell(-1);
              tabCell.innerHTML = myBooks[i][col[j]];
          }
      }

      // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
      var divContainer = document.getElementById("showData");
      divContainer.innerHTML = "";
      divContainer.appendChild(table);
    
</script>
</body>
